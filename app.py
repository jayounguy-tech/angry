import streamlit as st
import random
import time

# 1. é é¢åŸºæœ¬è¨­å®š
st.set_page_config(
    page_title="å®¶åº­ç”Ÿå­˜æ¨¡æ“¬å™¨",
    page_icon="ğŸ’€",
    layout="centered"
)

# 2. è‡ªå®šç¾© CSS (é»‘æš—é¢¨æ ¼ + èŠå¤©æ°£æ³¡æ¨£å¼)
st.markdown("""
<style>
    /* å…¨åŸŸèƒŒæ™¯è¨­ç‚ºæ·±ç°é»‘ */
    .stApp {
        background-color: #121212;
        color: #e0e0e0;
    }
    
    /* èª¿æ•´æ¨™é¡Œé¡è‰² */
    h1, h2, h3 {
        color: #ff5252 !important; /* å¸¶é»ç´…è‰²çš„è­¦å‘Šæ„Ÿ */
        font-family: 'Helvetica', sans-serif;
    }
    
    /* è¼¸å…¥æ¡†æ¨£å¼ */
    .stTextInput > div > div > input {
        background-color: #2d2d2d;
        color: #ffffff;
        border: 1px solid #444;
    }
    
    /* éš±è— Streamlit é è¨­çš„æ¼¢å ¡é¸å–®å’Œ footer */
    #MainMenu {visibility: hidden;}
    footer {visibility: hidden;}
    
    /* è‡ªå®šç¾©èŠå¤©æ°£æ³¡çš„ CSS (è¼”åŠ© Streamlit åŸç”Ÿ chat) */
    .stChatMessage {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
    }
    
    /* ä½¿ç”¨è€…æ°£æ³¡å¾®èª¿ */
    div[data-testid="stChatMessage"]:nth-child(odd) {
        background-color: rgba(64, 224, 208, 0.1); /* æ·¡æ·¡çš„é’è‰²ä»£è¡¨ä½¿ç”¨è€… */
    }
    
    /* æ©Ÿå™¨äºº(è€å©†/åª½åª½)æ°£æ³¡å¾®èª¿ */
    div[data-testid="stChatMessage"]:nth-child(even) {
        background-color: rgba(255, 82, 82, 0.15); /* æ·¡æ·¡çš„ç´…è‰²ä»£è¡¨æ€’æ°£ */
        border-left: 3px solid #ff5252;
    }
</style>
""", unsafe_allow_html=True)

# 3. å®šç¾©ã€Œå´©æ½°ç¢ç¢å¿µã€è³‡æ–™åº«
# åŒ…å«ä½¿ç”¨è€…æä¾›çš„ç¯„ä¾‹ä»¥åŠå»¶ä¼¸çš„èªå¥
NAGGING_DATABASE = [
    "ä½ èˆ‡å…¶æœ‰ç©ºåœ¨é‚£é‚Šçœ‹é€™äº›æœ‰çš„æ²’çš„ç‚ºä»€éº¼ä¸çœ‹ä¸€ä¸‹ä½ å¥³éµçš„ä½œæ¥­å¥¹è¯çµ¡ç°¿ç°½åäº†æ²’å¥¹ä½œæ¥­åœ¨é‚£é‚Šæ‹–æ‹–æ‹‰æ‹‰ä½ ä¸è¦ä¹Ÿåœ¨é‚£é‚Šè·Ÿè‘—å¥¹æ‹–æ‹–æ‹‰æ‹‰çš„å¥½ä¸å¥½ç„¶å¾Œæˆ‘å«ä½ é ˜çš„åŒ…è£¹ä½ å»é ˜äº†æ²’å·²ç¶“æœ€å¾Œä¸€å¤©äº†å–”æœ‰ä¸€ä»¶å·²ç¶“ä»˜æ¬¾äº†ä½ è¨˜å¾—å¸¶æˆ‘çš„è­‰ä»¶å»ä¸è¦åˆ°æ™‚å€™æ²’è¾¦æ³•é ˜åˆè¦ç™½è·‘ä¸€è¶Ÿ",
    "è®šä»€éº¼è®š å°å­©çš„ä½œæ¥­æª¢æŸ¥äº†å—ï¼Ÿæ˜å¤©è¯çµ¡ç°¿ä¸Šè¦å¸¶çš„æ±è¥¿å¼„å¥½äº†å—ï¼Ÿéƒ½å¹¾é»äº† å°å­©é‚„ä¸ç¡è¦º",
    "å«Œæˆ‘é¡§å°å­©ä¸å¤ ç´¯å—ï¼Ÿå®¶è£¡éƒ½è¦æˆ‘æ•´ç†ï¼Œä»€éº¼éƒ½è¦æˆ‘ç”¨ï¼Œè…¦è¢‹æ•´å¤©åªæœƒæƒ³é‚£äº›æ²’ç‡Ÿé¤Šçš„......",
    "æ¯”èµ·ä»€éº¼å¹½é»˜é¢¨è¶£ä½ å¥³éµè‹±æ–‡è£œç¿’çš„ä½œæ¥­è¦éŒ„éŸ³ä½ éŒ„äº†æ²’ä½ ä¸è¦ä»¥ç‚ºå¥¹å¤§è€ƒæ˜¨å¤©å‰›è€ƒå®Œå°±æ²’äº‹äº†ä½ å¿«å¹«å¥¹å¼„å¥½éŒ„å®Œä¹‹å¾Œå‚³çµ¦æˆ‘æˆ‘å†å‚³éè£œç¿’ç­ç„¶å¾Œåœ–æ›¸é¤¨å€Ÿçš„å¸ƒå¯æ˜Ÿçƒçš„æ›¸è¶•å¿«è®“å¥¹åšä¸€åšé‚„æœ‰å…«ä¹æœ¬éå¹¾å¤©è¦é‚„äº†ä¸ç„¶è¦éæœŸäº†æˆ‘æ˜å¤©ç™½å¤©é‚„æœ‰æ™šä¸Šé‚„è¦ä¸Šèª²äº‹æƒ…å¾ˆå¤šå¦‚æœä¸æ˜¯æ²’ç©ºæˆ‘ä¹Ÿä¸æƒ³è¦å«ä½ å¼„",
    "ä½ ç¾åœ¨æ˜¯åœ¨æ»‘æ‰‹æ©Ÿå—ï¼Ÿåƒåœ¾å€’äº†æ²’ï¼Ÿç¢—æ´—äº†æ²’ï¼Ÿä½ è¦ä¸è¦çœ‹ä¸€ä¸‹ç¾åœ¨å¹¾é»äº†ï¼Ÿ",
    "æˆ‘è¬›éå¹¾æ¬¡äº†è¥ªå­ä¸è¦äº‚ä¸Ÿï¼Œä½ æ˜¯ä¸æ˜¯è½ä¸æ‡‚äººè©±ï¼Ÿè·Ÿä½ å¥³å…’ä¸€æ¨£è¬›éƒ½è¬›ä¸è½ï¼Œæˆ‘çœŸçš„æ˜¯ä¸Šè¼©å­æ¬ ä½ å€‘çš„ã€‚",
    "ä¸è¦è·Ÿæˆ‘å¬‰çš®ç¬‘è‡‰ï¼Œæ˜å¤©è¦ç¹³çš„å­¸è²»å–®åœ¨æ¡Œä¸Šä½ çœ‹åˆ°äº†æ²’æœ‰ï¼Ÿé‚„æœ‰é‚£å€‹å®‰è¦ªç­è€å¸«èªªå¥¹æœ€è¿‘ä¸Šèª²å¾ˆä¸å°ˆå¿ƒï¼Œä½ æœ‰ç©ºä¸æœƒé—œå¿ƒä¸€ä¸‹å—ï¼Ÿ",
    "å»æ´—æ¾¡ï¼ä¸è¦å†æ‹–äº†ï¼å…¨å®¶éƒ½åœ¨ç­‰ä½ ä¸€å€‹äººï¼",
    "ä½ é‚£å€‹åŒ…è£¹åˆ°åº•æ˜¯è²·ä»€éº¼ï¼Ÿå®¶è£¡å·²ç¶“å †ä¸ä¸‹äº†ä½ çŸ¥ä¸çŸ¥é“ï¼ŸéŒ¢æ˜¯é€™æ¨£èŠ±çš„å—ï¼Ÿ",
    "æˆ‘çœ‹ä½ å€’æ˜¯å¾ˆé–’å˜›ï¼Œé‚„æœ‰ç©ºåœ¨é‚£é‚Šæ‰“å­—èŠå¤©ï¼Œå»æŠŠé™½å°è¡£æœæ”¶é€²ä¾†æŠ˜ä¸€æŠ˜å¥½ä¸å¥½ï¼Ÿ",
    "å˜†ä»€éº¼æ°£ï¼Ÿæˆ‘æ‰æƒ³å˜†æ°£å§ï¼Ÿæ¯å¤©åƒå€‹é™€èºä¸€æ¨£è½‰ï¼Œä½ å¹«éä»€éº¼å¿™ï¼Ÿ",
]

# 4. åˆå§‹åŒ– Session State (å„²å­˜å°è©±ç´€éŒ„)
if "messages" not in st.session_state:
    st.session_state.messages = []
    # é–‹å ´ç™½
    st.session_state.messages.append({
        "role": "assistant", 
        "content": "ä½ é‚„çŸ¥é“è¦å›ä¾†ï¼Ÿéƒ½å¹¾é»äº†ï¼Ÿ"
    })

# 5. ä»‹é¢æ¨™é¡Œ
st.title("â˜ ï¸ å®¶åº­ç”Ÿå­˜æ¨¡æ“¬å™¨")
st.caption("è«‹è¬¹æ…è¼¸å…¥ï¼Œå°æ–¹æƒ…ç·’å¾ˆä¸ç©©å®š...")

# 6. é¡¯ç¤ºæ­·å²è¨Šæ¯
for msg in st.session_state.messages:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])

# 7. è™•ç†è¼¸å…¥èˆ‡å›æ‡‰
if user_input := st.chat_input("èªªé»è©±ä¾†è¾¯è§£ (æˆ–è¨ç½µ)..."):
    # é¡¯ç¤ºä½¿ç”¨è€…è¼¸å…¥
    with st.chat_message("user"):
        st.markdown(user_input)
    st.session_state.messages.append({"role": "user", "content": user_input})

    # æ¨¡æ“¬æ€è€ƒåœé “ (å¢åŠ å£“è¿«æ„Ÿ)
    time.sleep(random.uniform(0.5, 1.5))

    # é¸æ“‡å›æ‡‰é‚è¼¯ (ç°¡å–®çš„é—œéµå­—è§¸ç™¼ + éš¨æ©Ÿ)
    response_text = ""
    
    # ç°¡å–®çš„é—œéµå­—æª¢æ¸¬
    if "å°ä¸èµ·" in user_input or "æŠ±æ­‰" in user_input:
        response_text = "é“æ­‰æœ‰ç”¨çš„è©±è¦è­¦å¯Ÿå¹¹å˜›ï¼Ÿä½ è‡ªå·±çœ‹çœ‹ç¾åœ¨å®¶è£¡äº‚æˆä»€éº¼æ¨£å­ï¼Ÿ"
    elif "ç´¯" in user_input:
        response_text = "ä½ ç´¯ï¼Ÿæˆ‘æ¯”ä½ æ›´ç´¯å¥½ä¸å¥½ï¼æˆ‘ç™½å¤©è¦ä¸Šç­æ™šä¸Šé‚„è¦é¡§å°å­©ï¼Œä½ åˆ°åº•åœ¨ç´¯ä»€éº¼ï¼Ÿ"
    elif "æ„›ä½ " in user_input:
        response_text = "å°‘åœ¨é‚£é‚ŠèŠ±è¨€å·§èªï¼Œå»æŠŠåœ°æ‹–ä¸€æ‹–æ¯”è¼ƒå¯¦éš›å•¦ã€‚"
    else:
        # å¦‚æœæ²’æœ‰ç‰¹å®šé—œéµå­—ï¼Œéš¨æ©ŸæŒ‘é¸ä¸€æ¢ã€Œé•·ç¯‡å¤§è«–ã€
        response_text = random.choice(NAGGING_DATABASE)

    # é¡¯ç¤ºæ©Ÿå™¨äººå›æ‡‰ (å¸¶æœ‰æ‰“å­—æ©Ÿæ•ˆæœ)
    with st.chat_message("assistant"):
        message_placeholder = st.empty()
        full_response = ""
        # æ¨¡æ“¬å¿«é€Ÿç¢å¿µçš„æ‰“å­—é€Ÿåº¦ (ç¨å¿«)
        for chunk in response_text:
            full_response += chunk
            message_placeholder.markdown(full_response + "â–Œ")
            time.sleep(0.02) 
        message_placeholder.markdown(full_response)
    
    st.session_state.messages.append({"role": "assistant", "content": full_response})